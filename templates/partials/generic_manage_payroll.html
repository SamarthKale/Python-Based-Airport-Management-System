{# templates/partials/generic_manage_payroll.html #}
<h1 class="h2 mb-4">Manage Payroll</h1>
<button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addPayrollModal"><i class="bi bi-plus-circle-fill"></i> Add Payroll Entry</button>
<div class="card shadow-sm">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-dark"><tr><th>Pay Date</th><th>Employee</th><th>Job Title</th><th>Base Salary</th><th>Bonus</th><th>Deductions</th><th>Net Pay</th></tr></thead>
        <tbody>
          {% for p in data.payrolls %}
          <tr>
            <td>{{ p.pay_date.strftime('%Y-%m-%d') if p.pay_date else 'N/A' }}</td>
            <td class="fw-bold">{{ p.employee_name }}</td>
            <td>{{ p.job_title }}</td>
            <td>${{ "%.2f"|format(p.base_salary or 0.0) }}</td>
            <td class="text-success">+${{ "%.2f"|format(p.bonus or 0.0) }}</td>
            <td class="text-danger">-${{ "%.2f"|format(p.deductions or 0.0) }}</td>
            <td class="fw-bold">${{ "%.2f"|format(p.net_pay or 0.0) }}</td>
          </tr>
          {% else %}
          <tr><td colspan="7" class="text-center text-muted">No payroll entries found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add Payroll Modal -->
<div class="modal fade" id="addPayrollModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form action="{{ url_for('generic_add_payroll') }}" method="POST">
        <div class="modal-header bg-primary text-white"><h5 class="modal-title">Add Payroll Entry</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <div class="mb-3"><label class="form-label">Employee *</label><select class="form-select" name="emp_id" required><option value="">Select Employee...</option>{% for e in data.employees %}<option value="{{ e.emp_id }}">{{ e.name }} (Base: ${{ "%.2f"|format(e.salary or 0.0) }})</option>{% endfor %}</select></div>
          <div class="mb-3"><label class="form-label">Pay Date *</label><input type="date" class="form-control" name="pay_date" required></div>
          <div class="mb-3"><label class="form-label">Bonus</label><input type="number" step="0.01" class="form-control" name="bonus" value="0.00"></div>
          <div class="mb-3"><label class="form-label">Deductions</label><input type="number" step="0.01" class="form-control" name="deductions" value="0.00"></div>
        </div>
        <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button><button class="btn btn-primary" type="submit">Save Entry</button></div>
      </form>
    </div>
  </div>
</div>
